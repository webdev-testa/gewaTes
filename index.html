<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        padding: 0;
        margin: 0;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
      }
      .card {
        background: white;
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      h1 {
        margin: 0 0 8px 0;
        color: #1a202c;
        font-size: 28px;
      }
      .description {
        color: #718096;
        margin-bottom: 32px;
        line-height: 1.6;
      }
      .form-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2d3748;
      }
      input[type="text"],
      input[type="date"],
      textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.2s;
      }
      input:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
      }
      .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin-top: 20px;
      }
      .product-card {
        border: 3px solid #e2e8f0;
        border-radius: 12px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
      }
      .product-card:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
      }
      .product-card.selected {
        border-color: #667eea;
        background: #eef2ff;
      }
      .product-img {
        width: 100%;
        height: 120px;
        background: #f7fafc;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        margin-bottom: 12px;
      }
      .size-options {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-top: 20px;
      }
      .size-item {
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 16px;
      }
      .size-img {
        width: 80px;
        height: 80px;
        background: #f7fafc;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        flex-shrink: 0;
      }
      .size-info {
        flex: 1;
      }
      .size-name {
        font-weight: 600;
        font-size: 18px;
        margin-bottom: 4px;
      }
      .quantity-control {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .qty-btn {
        width: 36px;
        height: 36px;
        border: 2px solid #667eea;
        background: white;
        border-radius: 8px;
        color: #667eea;
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }
      .qty-btn:hover {
        background: #667eea;
        color: white;
      }
      .qty-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }
      .qty-display {
        font-size: 20px;
        font-weight: 600;
        min-width: 40px;
        text-align: center;
      }
      .btn {
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 24px;
      }
      .btn-primary {
        background: #667eea;
        color: white;
      }
      .btn-primary:hover {
        background: #5a67d8;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }
      .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }
      .btn-secondary {
        background: #e2e8f0;
        color: #2d3748;
      }
      .btn-secondary:hover {
        background: #cbd5e0;
      }
      .page {
        display: none;
      }
      .page.active {
        display: block;
        animation: fadeIn 0.3s;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .order-item {
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .order-item-header {
        font-weight: 600;
        font-size: 18px;
        margin-bottom: 12px;
        color: #2d3748;
      }
      .color-options {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
        flex-wrap: wrap;
      }
      .color-btn {
        padding: 8px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
      }
      .color-btn.selected {
        border-color: #667eea;
        background: #eef2ff;
      }
      .greeting-card {
        margin-top: 12px;
      }
      .char-count {
        text-align: right;
        font-size: 14px;
        color: #718096;
        margin-top: 4px;
      }
      .review-section {
        margin-bottom: 24px;
      }
      .review-section h3 {
        color: #2d3748;
        margin-bottom: 12px;
      }
      .review-item {
        padding: 12px;
        background: #f7fafc;
        border-radius: 8px;
        margin-bottom: 8px;
      }
      .success-icon {
        font-size: 64px;
        text-align: center;
        margin: 32px 0;
      }
      .error-msg {
        background: #fed7d7;
        color: #c53030;
        padding: 12px;
        border-radius: 8px;
        margin-top: 16px;
      }
      .progress-bar {
        height: 4px;
        background: #e2e8f0;
        border-radius: 2px;
        margin-bottom: 24px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        background: #667eea;
        transition: width 0.3s;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <div class="progress-bar">
          <div class="progress-fill" id="progressBar"></div>
        </div>

        <!-- Page 1: Customer Info & Product Selection -->
        <div class="page active" id="page1">
          <h1>üå∏ Submit Your Flower Order Here</h1>
          <p class="description">
            Isi formulir ini setelah konsep warna rangkaian bunga
            dikonsultasikan dengan admin By Gewa, ya! üå∏‚ú® Setelah formulir
            dikirim, kamu mendapatkan 1x kesempatan saja untuk revisi warna.
            üé®üí´ Jadi, pastikan semua data yang kamu submit sudah benar dan
            lengkap, mulai dari alamat, jumlah pesanan, hingga pilihan warna
            üè°üì¶üéÄ Jika ada kendala, silakan hubungi admin kembali melalui: üì≤
            WhatsApp di +62858-2222-0904
          </p>

          <div class="form-group">
            <label>Name *</label>
            <input
              type="text"
              id="customerName"
              placeholder="Enter your name"
            />
          </div>

          <div class="form-group">
            <label>Instagram*</label>
            <input type="text" id="instagram" placeholder="@username" />
          </div>

          <div class="form-group">
            <label>Select Product Type *</label>
            <div class="product-grid" id="productGrid">
              <div class="product-card" data-product="bouquet">
                <div class="product-img">üíê</div>
                <div>Bouquet</div>
              </div>
              <div class="product-card" data-product="hand-bouquet">
                <div class="product-img">üåπ</div>
                <div>Hand Bouquet</div>
              </div>
              <div class="product-card" data-product="vase">
                <div class="product-img">üè∫</div>
                <div>Vase</div>
              </div>
              <div class="product-card" data-product="decoration">
                <div class="product-img">üéÄ</div>
                <div>Decoration</div>
              </div>
              <div class="product-card" data-product="signature">
                <div class="product-img">‚ú®</div>
                <div>Signature</div>
              </div>
            </div>
          </div>

          <button class="btn btn-primary" onclick="goToPage2()">Next</button>
        </div>

        <!-- Page 2: Size Selection -->
        <div class="page" id="page2">
          <h1>Select Sizes</h1>
          <p class="description">
            Choose the sizes and quantities you'd like to order.
          </p>

          <div class="size-options" id="sizeOptions"></div>

          <button class="btn btn-primary" onclick="goToPage3()">Next</button>
        </div>

        <!-- Page 3: Order Specification -->
        <div class="page" id="page3">
          <h1>Specify Your Order</h1>
          <p class="description">
            Choose colors and add greeting cards for each item.
          </p>

          <div id="orderSpecifications"></div>

          <button class="btn btn-primary" onclick="goToPage4()">Next</button>
        </div>

        <!-- Page 4: Delivery Details -->
        <div class="page" id="page4">
          <h1>Delivery Details</h1>
          <p class="description">
            When and where should we deliver your order?
          </p>

          <div class="form-group">
            <label>Delivery Date *</label>
            <input type="date" id="deliveryDate" />
          </div>

          <div class="form-group">
            <label>Delivery Address *</label>
            <textarea
              id="deliveryAddress"
              rows="3"
              placeholder="Enter full delivery address"
            ></textarea>
          </div>

          <button class="btn btn-primary" onclick="goToPage5()">Next</button>
        </div>

        <!-- Page 5: Additional Products -->
        <div class="page" id="page5">
          <h1>Add More Products?</h1>
          <p class="description">
            Would you like to add any other items to your order?
          </p>

          <div class="product-grid" id="additionalProducts"></div>

          <button class="btn btn-secondary" onclick="goToPage6()">
            No Thanks, Review Order
          </button>
        </div>

        <!-- Page 6: Review Order -->
        <div class="page" id="page6">
          <h1>Review Your Order</h1>
          <p class="description">
            Please review your order details before confirming.
          </p>

          <div id="orderReview"></div>

          <button class="btn btn-primary" onclick="submitOrder()">
            Confirm Order
          </button>
          <div id="errorMsg"></div>
        </div>

        <!-- Page 7: Thank You -->
        <div class="page" id="page7">
          <div class="success-icon">‚úÖ</div>
          <h1 style="text-align: center">Thank You!</h1>
          <p class="description" style="text-align: center">
            Your order has been received. Please confirm your order via
            WhatsApp.
          </p>

          <button class="btn btn-primary" id="whatsappBtn">
            Confirm via WhatsApp
          </button>
        </div>
      </div>
    </div>

    <script>
      // --- GLOBAL VARIABLES ---
      let currentPage = 1;
      let orderData = {
        customerName: "",
        instagram: "",
        selectedProducts: [],
        deliveryDate: "",
        deliveryAddress: "",
      };

      const productSizes = {
        bouquet: ["Small", "Medium", "Large"],
        "hand-bouquet": ["Standard", "Premium"],
        vase: ["Small", "Medium", "Large"],
        decoration: ["Basic", "Standard", "Premium"],
        signature: ["Classic", "Deluxe"],
      };

      const productEmojis = {
        bouquet: "üíê",
        "hand-bouquet": "üåπ",
        vase: "üè∫",
        decoration: "üéÄ",
        signature: "‚ú®",
      };

      const colorOptions = [
        "Red",
        "Blue",
        "Pink",
        "White",
        "Yellow",
        "Purple",
        "Mixed",
      ];

      // --- INITIALIZATION ---
      document.addEventListener("DOMContentLoaded", function () {
        console.log("App initialized.");

        // Attach click listeners
        const cards = document.querySelectorAll("#productGrid .product-card");
        cards.forEach((card) => {
          card.addEventListener("click", function () {
            cards.forEach((c) => c.classList.remove("selected"));
            this.classList.add("selected");
          });
        });

        updateProgressBar(1);
      });

      // --- NAVIGATION FUNCTIONS ---

      function goToPage2() {
        const name = document.getElementById("customerName").value.trim();
        const instagram = document.getElementById("instagram").value.trim();
        const selectedCard = document.querySelector(
          "#productGrid .product-card.selected"
        );

        if (!name || !instagram) {
          alert("Please enter your Name and Instagram handle.");
          return;
        }
        if (!selectedCard) {
          alert("Please select a product type.");
          return;
        }

        orderData.customerName = name;
        orderData.instagram = instagram;

        const productType = selectedCard.dataset.product;
        // Add new product or update existing last entry
        const currentProduct = { type: productType, sizes: [] };

        if (orderData.selectedProducts.length === 0) {
          orderData.selectedProducts.push(currentProduct);
        } else {
          orderData.selectedProducts[orderData.selectedProducts.length - 1] =
            currentProduct;
        }

        // Generate size options
        const sizeOptionsDiv = document.getElementById("sizeOptions");
        sizeOptionsDiv.innerHTML = "";

        productSizes[productType].forEach((size) => {
          const sizeDiv = document.createElement("div");
          sizeDiv.className = "size-item";
          sizeDiv.innerHTML = `
            <div class="size-img">${productEmojis[productType]}</div>
            <div class="size-info">
              <div class="size-name">${size}</div>
              <div class="quantity-control">
                <button class="qty-btn" onclick="changeQty('${size}', -1)">‚àí</button>
                <div class="qty-display" id="qty-${size}">0</div>
                <button class="qty-btn" onclick="changeQty('${size}', 1)">+</button>
              </div>
            </div>`;
          sizeOptionsDiv.appendChild(sizeDiv);
        });

        showPage(2);
      }

      function changeQty(size, delta) {
        const qtyEl = document.getElementById(`qty-${size}`);
        let qty = parseInt(qtyEl.textContent) || 0;
        qty = Math.max(0, qty + delta);
        qtyEl.textContent = qty;
      }

      function goToPage3() {
        const currentProduct =
          orderData.selectedProducts[orderData.selectedProducts.length - 1];
        const sizes = productSizes[currentProduct.type];

        currentProduct.sizes = [];

        sizes.forEach((size) => {
          const qtyEl = document.getElementById(`qty-${size}`);
          const qty = parseInt(qtyEl ? qtyEl.textContent : 0) || 0;
          if (qty > 0) {
            currentProduct.sizes.push({ size, quantity: qty, items: [] });
          }
        });

        if (currentProduct.sizes.length === 0) {
          alert("Please select at least one item quantity.");
          return;
        }

        const specDiv = document.getElementById("orderSpecifications");
        specDiv.innerHTML = "";

        currentProduct.sizes.forEach((sizeObj, sizeIdx) => {
          for (let i = 0; i < sizeObj.quantity; i++) {
            const itemDiv = document.createElement("div");
            itemDiv.className = "order-item";

            // Build color buttons HTML
            const buttonsHtml = colorOptions
              .map(
                (color) =>
                  `<button class="color-btn" onclick="selectColor(this)">${color}</button>`
              )
              .join("");

            itemDiv.innerHTML = `
              <div class="order-item-header">${currentProduct.type} - ${
              sizeObj.size
            } (Item #${i + 1})</div>
              <label>Color *</label>
              <div class="color-options" id="colors-${sizeIdx}-${i}">${buttonsHtml}</div>
              <div class="greeting-card">
                <label>Greeting Card (Optional)</label>
                <textarea rows="2" maxlength="300" id="greeting-${sizeIdx}-${i}" 
                  placeholder="Message..." oninput="updateCharCount(this)"></textarea>
                <div class="char-count">0/300</div>
              </div>`;
            specDiv.appendChild(itemDiv);
          }
        });

        showPage(3);
      }

      function selectColor(btn) {
        btn.parentElement
          .querySelectorAll(".color-btn")
          .forEach((b) => b.classList.remove("selected"));
        btn.classList.add("selected");
      }

      function updateCharCount(textarea) {
        textarea.nextElementSibling.textContent = `${textarea.value.length}/300`;
      }

      function goToPage4() {
        const currentProduct =
          orderData.selectedProducts[orderData.selectedProducts.length - 1];
        let allValid = true;

        currentProduct.sizes.forEach((sizeObj, sizeIdx) => {
          sizeObj.items = [];
          for (let i = 0; i < sizeObj.quantity; i++) {
            const colorContainer = document.getElementById(
              `colors-${sizeIdx}-${i}`
            );
            const selectedBtn = colorContainer.querySelector(".selected");
            const greeting = document
              .getElementById(`greeting-${sizeIdx}-${i}`)
              .value.trim();

            if (!selectedBtn) {
              allValid = false;
            } else {
              sizeObj.items.push({
                color: selectedBtn.textContent,
                greeting: greeting,
              });
            }
          }
        });

        if (!allValid) {
          alert("Please select a color for every item.");
          return;
        }
        showPage(4);
      }

      function goToPage5() {
        const dDate = document.getElementById("deliveryDate").value;
        const dAddr = document.getElementById("deliveryAddress").value.trim();

        if (!dDate || !dAddr) {
          alert("Please fill in Delivery Date and Address.");
          return;
        }

        orderData.deliveryDate = dDate;
        orderData.deliveryAddress = dAddr;

        // Show additional products
        const selectedTypes = orderData.selectedProducts.map((p) => p.type);
        const allProducts = [
          "bouquet",
          "hand-bouquet",
          "vase",
          "decoration",
          "signature",
        ];
        const available = allProducts.filter((p) => !selectedTypes.includes(p));

        const addDiv = document.getElementById("additionalProducts");
        addDiv.innerHTML = "";

        if (available.length === 0) {
          addDiv.innerHTML = "<p>You have selected all types!</p>";
        } else {
          available.forEach((prod) => {
            const card = document.createElement("div");
            card.className = "product-card";
            card.innerHTML = `<div class="product-img">${
              productEmojis[prod]
            }</div><div>${formatName(prod)}</div>`;
            card.onclick = function () {
              orderData.selectedProducts.push({ type: prod, sizes: [] });
              // Re-trigger page 2 setup manually
              const sizes = productSizes[prod];
              const sizeDiv = document.getElementById("sizeOptions");
              sizeDiv.innerHTML = "";
              sizes.forEach((size) => {
                sizeDiv.innerHTML += `
                  <div class="size-item">
                    <div class="size-img">${productEmojis[prod]}</div>
                    <div class="size-info">
                      <div class="size-name">${size}</div>
                      <div class="quantity-control">
                        <button class="qty-btn" onclick="changeQty('${size}', -1)">‚àí</button>
                        <div class="qty-display" id="qty-${size}">0</div>
                        <button class="qty-btn" onclick="changeQty('${size}', 1)">+</button>
                      </div>
                    </div>
                  </div>`;
              });
              showPage(2);
            };
            addDiv.appendChild(card);
          });
        }
        showPage(5);
      }

      function formatName(str) {
        return str
          .split("-")
          .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
          .join(" ");
      }

      function goToPage6() {
        const revDiv = document.getElementById("orderReview");
        let html = `<div class="review-section"><h3>üë§ Customer</h3>
          <div class="review-item">Name: ${orderData.customerName}</div>
          <div class="review-item">IG: ${orderData.instagram}</div></div>
          <div class="review-section"><h3>üõçÔ∏è Items</h3>`;

        orderData.selectedProducts.forEach((prod) => {
          prod.sizes.forEach((sz) => {
            sz.items.forEach((it) => {
              html += `<div class="review-item"><strong>${
                productEmojis[prod.type]
              } ${formatName(prod.type)} (${sz.size})</strong><br>Color: ${
                it.color
              }`;
              if (it.greeting) html += `<br><i>"${it.greeting}"</i>`;
              html += `</div>`;
            });
          });
        });

        html += `</div><div class="review-section"><h3>üöö Delivery</h3>
          <div class="review-item">Date: ${orderData.deliveryDate}</div>
          <div class="review-item">Address: ${orderData.deliveryAddress}</div></div>`;

        revDiv.innerHTML = html;
        showPage(6);
      }

      function submitOrder() {
        const btn = event.target;
        btn.disabled = true;
        btn.innerText = "Processing...";
        const errDiv = document.getElementById("errorMsg");
        errDiv.innerHTML = "";

        google.script.run
          .withSuccessHandler(function () {
            // --- BUILD WHATSAPP MESSAGE ---
            let msg = `üå∏ *New Order*%0A%0A`;
            msg += `*Name:* ${orderData.customerName}%0A`;
            msg += `*IG:* ${orderData.instagram}%0A%0A`;

            orderData.selectedProducts.forEach((p) => {
              p.sizes.forEach((s) => {
                s.items.forEach((i) => {
                  msg += `- ${formatName(p.type)} (${s.size}, ${i.color})`;
                  if (i.greeting) msg += ` + Card`;
                  msg += `%0A`;
                });
              });
            });
            msg += `%0A*Date:* ${orderData.deliveryDate}%0A`;
            msg += `*Address:* ${orderData.deliveryAddress}`;

            // --- WHATSAPP BUTTON SETUP ---
            document.getElementById("whatsappBtn").onclick = function () {
              // IMPORTANT: Use Backticks ` ` for the URL, not single ' ' or double " " quotes!
              // Replace 628123456789 with your number
              const phoneNumber = ""; // e.g. "628123456789"
              const url = `https://wa.me/${phoneNumber}?text=${msg}`;
              window.open(url, "_blank");
            };

            showPage(7);
          })
          .withFailureHandler(function (e) {
            btn.disabled = false;
            btn.innerText = "Confirm Order";
            errDiv.innerHTML = `<div class="error-msg">Error: ${e.message}</div>`;
          })
          .saveOrder(orderData);
      }

      function showPage(num) {
        document
          .querySelectorAll(".page")
          .forEach((p) => p.classList.remove("active"));
        document.getElementById(`page${num}`).classList.add("active");
        currentPage = num;
        updateProgressBar(num);
        window.scrollTo(0, 0);
      }

      function updateProgressBar(num) {
        document.getElementById("progressBar").style.width =
          (num / 7) * 100 + "%";
      }
    </script>
  </body>
</html>

